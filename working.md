## Working

### Working for the Home screen

- After filling the form fields entered by the user in the **`react-portal`**, user needs to click on the `Submit` button and it will make an API call to get the `vehicleDetails`

    ```javascript
    // it will be used only in the react-portal
    "method": "POST"
    "url": "https://integra.agiliux.com/common/vehicleinfo"
    "Content-Type": "application/json"
    "Tenant_id": "67b61490-fec2-11ed-a640-e19d1712c006"
    "body": {
        "vehregno": "AHC5758", // vehicleRegNo
        "idtype": "NRIC", // userIdType
        "id_comregno": "580127035192", // userIdNo
        "postalcode": "63000" // userPostalCode
    }
    ```

- In the Agiliux backend server(`node.js`):

    - It will check the `token`(***accessToken*** generated by the isurer to get vehicle's info. By default, they don't allow to send vehicle's details to any API call) exists in agiliux database(`MongoDb`), if exists then check the validity or expiry time of the `token`.

    - If the `token` got expire or doesn't exists then make an API call to insurer to generate new `token` and store that `token` in agiliux database(`MongoDb`).

        ```js
        // it will be only called from the agiliux backend
        // insurer's API to generate accessToken
        "method": "POST"
        "url": "https://apiuat.allianz.com.my/v1/oauth/accesstoken"
        "Conten-Type": "application/json"
        "body": {
            "grant_type": "client_credentials"
        }
        ```

    - Else make an API call to the insurer's API to get vehicleInfo by passing the `token` in headers:

        ```js
        // it will be only called from the agiliux backend
        // insurer's API to get vehicleInfo
        "method": "POST"
        "url": "https://apiuat.allianz.com.my/v1/openapi/mci/vehicleDetails"
        "headers": {
            "Authorization": "Bearer AUIKzujGT8DDJs9Gt3nMCqfXcyiQ",
            "accept": "application/json",
            "Content-Type": "application/json"
        }
        "accept": "application/json"
        "Conten-Type": "application/json"
        "body": {
            "sourceSystem": "PARTNER_ID",
            "vehicleLicenseId": "AKF2633", // vehicle's no
            "identityType": "NRIC", // user's idType
            "identityNumber": "841103011116", // user's idNo
            "checkUbbInd": 1,
            "postalCode": "50000" // user's postalCode
        }
        ```

    - Insurer's API will send the response based on the vehicle's registration number. If didn't found any then it will send two error response but with **`200`** status:
    
        ```js
        // Insurer's API response to get vehicleInfo
        {
            "contractNumber": "CNAZ00002585408",
            "errors": [
                "Data not found."
            ]
        }
        ```

        Or

        ```js
        // Insurer's API response to get vehicleInfo
        {
            "contractNumber": "CNAZ00002585410",
            "errors": [
            "Error in IDNo1 or IDNo2, or ID does not match. Ensure IdNo1 or IdNo2 is correct. Ensure the insurance/takaful code is correct."
            ]
        }
        ```

    - If the vehicle's information exists then it will send back to the agilux backend(`node.js`)

- The agiliux backend(**`node.js`**) will send that response back to the **`react-portal`**

- If there are some errors in the response then update the state for errors created in the component as per response and message. User would able to see the popup based on the errors or warnings.

- Else update the redux store based on the API response. Then redirect the user to next page